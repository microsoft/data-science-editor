# CODAL Message Bus

This extension turns the micro:bit into a server for the [CODAL Message Bus](/services/codalmessagebus) service.
This service allows to raise events registered in the MakeCode program (using the `control.onEvent` block) from Jacdac.
This is useful if you need to trigger code running on the embedded device from another module.

## Setup

You will need to add this extension manually in MakeCode.

-   Open **Extensions**
-   Search for https://github.com/microsoft/pxt-jacdac/codal-message-bus-server
-   Include the extension found

## Usage

In your `on start`, start the server

```blocks
-----
dep: jacdac-codal-message-bus-server=github:microsoft/pxt-jacdac/codal-message-bus-server/
-----
servers.codalMessageBus.start()
```

then register event handlers for custom values.

```blocks
-----
dep: jacdac-codal-message-bus-server=github:microsoft/pxt-jacdac/codal-message-bus-server/
-----
servers.codalMessageBus.start()
control.onEvent(10000, 1, () => {
    basic.showIcon(IconNames.Happy)
})
```

Then from the dashboard or your other Jacdac program, send a command packet with `1000, 1` to trigger that event.
